@model Phorcys.Web.Models.ChecklistInstanceViewModel
@using Kendo.Mvc.UI

@{
    ViewData["Title"] = "Check List";
}

<section class="jumbotron text-center">
    <div class="container">
        <h1 class="jumbotron-heading">Check List</h1>
        <p class="lead text-muted">@Model.Title</p>
    </div>
</section>

@Html.AntiForgeryToken()

<div class="row">
    <div class="col-12">
        @(
            Html.Kendo().Grid<Phorcys.Web.Models.ChecklistInstanceItemViewModel>()
                .Name("ChecklistInstanceGrid")
                .Columns(columns =>
                {                    
                    columns.Bound(i => i.ChecklistInstanceItemId)
                        .Hidden();
                    columns.Bound(i => i.SequenceNumber).Title("#").Width(80);
                    columns.Bound(i => i.IsChecked)
                        .Title("Checked")
                        .Width(120)
                        .ClientTemplate("<input type='checkbox' #= IsChecked ? 'checked=\\\"checked\\\"' : '' # onclick=\\\"return false;\\\" />")
                        .EditorTemplateName("ChecklistInstanceIsChecked");
                    columns.Bound(i => i.Title).Title("Item");
                })
                .Mobile()
                .Resizable(resize => resize.Columns(true))
                .ToolBar(toolbar =>
                {
                    toolbar.Excel();
                    toolbar.Pdf();
                    toolbar.Search();
                })
                .Editable(edit => edit.Mode(GridEditMode.InCell))
                .ColumnMenu(col => col.Filterable(true))
                .DataSource(ds => ds.Ajax()
                    .Batch(true)
                    .AutoSync(true)
                    .Model(m =>
                    {
                        m.Id(i => i.ChecklistInstanceItemId);
                        m.Field(f => f.ChecklistInstanceItemId).Editable(false);
                        m.Field(f => f.SequenceNumber).Editable(false);
                        m.Field(f => f.Title).Editable(false);
                        m.Field(f => f.IsChecked);
                    })
                    .Read(read => read.Action("ChecklistInstanceItems_Read", "Checklist", new { id = Model.ChecklistId }))
                    .Update(update => update.Action("ChecklistInstanceItems_Update", "Checklist", new { checklistId = Model.ChecklistId }))
                )
                .Excel(excel => excel
                    .AllPages(true)
                    .FileName("ChecklistItems.xlsx")
                    .ProxyURL(Url.Action("Excel_Export_Save", "Grid")))
                .Pdf(pdf => pdf
                    .AllPages(true)
                    .FileName("ChecklistItems.pdf")
                    .ProxyURL(Url.Action("Excel_Export_Save", "Grid")))
                .Pageable(page => page
                    .ButtonCount(5)
                    .Refresh(true)
                    .PageSizes(new[] { 5, 10, 20, 40, 800 }))
                .Sortable()
                .Groupable()
                .Filterable()
                .Scrollable()
        )
    </div>
</div>

<p class="mt-3">
    <a class="btn btn-secondary" href="@Url.Action("Index", "Checklist")">Back to Checklists</a>
</p>

